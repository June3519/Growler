{% extends "defaultLayout.html" %}
{% block content %}
    <div id="app">
        <div class="relative z-10 bg-white rounded-tr-xl sm:rounded-t-xl lg:rounded-xl shadow-lg">
            <!-- Recent Message  Area -->
            <ul class="grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-1 xl:grid-cols-1 gap-4">
                <li v-for="msg in existsMessages">
                    <div class="group cursor-pointer rounded-lg p-4 border border-gray-900 hover:bg-light-blue-500">
                        <dl class="grid sm:block lg:grid xl:block grid-cols-2 grid-rows-2 items-center">

                            <dd class="leading-6 font-medium text-black group-hover:text-light-blue-500">
                                <span>${ msg.directMessageTexts }$</span>
                                <span>${ msg.senderUser.nickName }$</span>
                                <span>${ msg.createdAt }$</span>
                            </dd>
                            <br>
                            <div class="col-start-2 row-start-1 row-end-3">
                                <dd class="flex justify-end space-x-2">
                                    <a class="text-red-500" v-for="tag in post.tagList" v-bind:href="'/chat/'+tag.tag">#${
                                        tag.tag }$</a>
                                </dd>
                            </div>
                            <div>
                                <dd class="text-sm font-medium group-hover:text-light-blue-200 sm:mb-4 lg:mb-0 xl:mb-4">
                                    ${ post.createdAt }$
                                </dd>
                            </div>
                        </dl>
                    </div>
                </li>
            </ul>
            <div class="fixed left-0 bottom-10 right-0 z-50">
                <input class="focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 pl-1"
                       type="text" aria-label="Filter projects" placeholder="input messages..."
                       v-model="newMessage">

                <button id="buttonNewGrowl"
                        class="focus:outline-none text-sm w-full py-3 rounded-md font-semibold text-white bg-blue-500 ring-2"
                        v-on:click="sendMessage"
                >
                    SendMessage
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script src="/static/axios/axios.min.js"></script>
    <script src="/static/vue/vue.js"></script>
    <script>
        app = {
            compilerOptions: {
                delimiters: ['${', '}$']
            },
            mounted() {
                this.getRecentMessages();
            },
            data() {
                return {
                    roomId: '{{ roomId }}',
                    newMessage: '',
                    existsMessages: [],
                };
            },
            methods: {
                getRecentMessages() {
                    axios.get(`/dm/recent/${this.roomId}`
                    ).then(function (response) {
                        appInstance.existsPosts = response.data;
                    }).catch(function (error) {
                        alert(error.response.data);
                    })
                },
                sendMessage() {
                    if (isNewPosting === true) return;
                    isNewPosting = true;

                    axios.post('/growl', {
                        message: this.newMessage,
                        tags: this.newTags,
                    }).then(function (response) {
                        appInstance.newMessage = '';
                        appInstance.newTags = '';
                        appInstance.getRecentPost();
                    }).catch(function (error) {
                        alert(error.response.data);
                    }).finally(function () {
                    })
                }
            }
        }

        let appInstance = Vue.createApp(app).mount('#app')
    </script>
{% endblock %}